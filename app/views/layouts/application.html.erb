<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- Primary Meta Tags -->
  <title><%= @title || 'Lukasz Czapiewski - Full Stack Developer' %></title>
  <meta name="title" content="<%= @title || 'Lukasz Czapiewski - Full Stack Developer' %>">
  <meta name="description" content="<%= @description || 'Full stack developer passionate about Ruby on Rails and building things that matter. Based in Cheltenham, UK.' %>">
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="<%= @url || 'https://lukaszczapiewski.com' %>">
  <meta property="og:title" content="<%= @title || 'Lukasz Czapiewski - Full Stack Developer' %>">
  <meta property="og:description" content="<%= @description || 'Full stack developer passionate about Ruby on Rails and building things that matter. Based in Cheltenham, UK.' %>">
  <meta property="og:image" content="<%= @image || 'https://lukaszczapiewski.com/images/profile.jpeg' %>">
  
  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="<%= @url || 'https://lukaszczapiewski.com' %>">
  <meta property="twitter:title" content="<%= @title || 'Lukasz Czapiewski - Full Stack Developer' %>">
  <meta property="twitter:description" content="<%= @description || 'Full stack developer passionate about Ruby on Rails and building things that matter. Based in Cheltenham, UK.' %>">
  <meta property="twitter:image" content="<%= @image || 'https://lukaszczapiewski.com/images/profile.jpeg' %>">
  
  <!-- Canonical URL -->
  <link rel="canonical" href="<%= @url || 'https://lukaszczapiewski.com' %>">
  
  <!-- RSS Feed -->
  <link rel="alternate" type="application/rss+xml" title="Lukasz Czapiewski - Blog RSS Feed" href="https://lukaszczapiewski.com/feed.xml">
  
  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  
  <!-- Stylesheet -->
  <link rel="stylesheet" href="/assets/stylesheets/application.css">
  
  <!-- Theme initialization script to prevent flash -->
  <script>
    (function() {
      function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
        return null;
      }
      const theme = getCookie('theme') || 'dark';
      if (theme === 'light') {
        document.documentElement.classList.remove('dark');
      } else {
        document.documentElement.classList.add('dark');
      }
    })();
  </script>
</head>
<body class="dark:bg-slate-950 bg-slate-50">
  <% 
    # Automatically set @current_page from @url if not already set
    @current_page ||= if @url
      uri = URI.parse(@url)
      uri.path
    else
      '/'
    end
  %>
  <main class="dark:bg-slate-950 bg-slate-50">
    <% unless @current_page == '/space-shooter' %>
      <%= render 'shared/header' %>
    <% end %>
    <%= page_content %>
    <% unless @current_page == '/space-shooter' %>
      <%= render 'shared/footer' %>
    <% end %>
  </main>

  <!-- Cookies Popup -->
  <%= render 'shared/cookies_popup' %>

  <!-- Theme Switcher -->
  <% unless @current_page == '/space-shooter' %>
  <div 
    data-controller="theme-switcher" 
    class="fixed top-auto bottom-6 md:top-6 md:bottom-auto right-6 z-50 opacity-0 translate-y-4 pointer-events-none transition-all duration-500 ease-out"
  >
    <button
      type="button"
      data-action="click->theme-switcher#toggle"
      class="group relative w-20 h-20 flex items-center justify-center cursor-pointer focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 dark:focus:ring-offset-slate-950 focus:ring-offset-slate-50 rounded-full"
      aria-label="Toggle theme"
    >
      <!-- Cloud Background -->
      <svg 
        class="absolute top-0 right-0 w-3/4 h-3/4 theme-switcher-cloud dark:opacity-100 opacity-100 transition-opacity duration-300 z-10"
        viewBox="0 0 100 100"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <!-- Cloud shape -->
        <path 
          d="M25 50C25 40 30 35 35 35C35 30 40 25 50 25C60 25 65 30 65 35C70 35 75 40 75 50C80 50 85 55 85 60C85 65 80 70 75 70H25C20 70 15 65 15 60C15 55 20 50 25 50Z"
          class="fill-slate-600/80 dark:fill-slate-400/80 transition-colors duration-300"
        />
      </svg>

      <!-- Sun (visible in dark mode) -->
      <svg 
        class="absolute inset-0 w-full h-full theme-switcher-sun dark:opacity-100 opacity-0 transition-opacity duration-300 dark:text-yellow-500 z-0"
        viewBox="0 0 100 100"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <circle cx="50" cy="50" r="20" fill="currentColor" />
        <path d="M50 10 L50 5 M50 95 L50 90 M10 50 L5 50 M95 50 L90 50" stroke="currentColor" stroke-width="3" stroke-linecap="round" />
        <path d="M25.86 25.86 L22.63 22.63 M77.37 77.37 L74.14 74.14 M25.86 74.14 L22.63 77.37 M77.37 22.63 L74.14 25.86" stroke="currentColor" stroke-width="3" stroke-linecap="round" />
      </svg>

      <!-- Moon (visible in light mode) -->
      <svg 
        class="absolute inset-0 w-full h-full theme-switcher-moon dark:opacity-0 opacity-100 transition-opacity duration-300 z-0"
        viewBox="0 0 100 100"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <defs>
          <radialGradient id="moon-gradient" cx="35%" cy="35%">
            <stop offset="0%" stop-color="#fefce8"/>
            <stop offset="100%" stop-color="#e4e4d7"/>
          </radialGradient>
        </defs>
        <circle cx="50" cy="50" r="25" fill="url(#moon-gradient)"/>
        <!-- Craters -->
        <circle cx="45" cy="40" r="3" fill="#94a3b8" opacity="0.7"/>
        <circle cx="55" cy="45" r="2.5" fill="#94a3b8" opacity="0.6"/>
        <circle cx="42" cy="55" r="2" fill="#94a3b8" opacity="0.7"/>
        <circle cx="58" cy="58" r="2.5" fill="#94a3b8" opacity="0.6"/>
        <circle cx="50" cy="50" r="1.5" fill="#94a3b8" opacity="0.5"/>
        <ellipse cx="48" cy="48" rx="1.5" ry="2" fill="#94a3b8" opacity="0.6"/>
        <ellipse cx="52" cy="52" rx="2" ry="1.5" fill="#94a3b8" opacity="0.6"/>
      </svg>
    </button>
  </div>
  <% end %>

  <% if importmap_json %>
    <script type="importmap">
      <%= raw importmap_json %>
    </script>
  <% end %>

  <%
    modules_to_import = (@js_modules || []).dup
    modules_to_import << 'application' unless modules_to_import.include?('application')
  %>
  <% modules_to_import.each do |module_name| %>
    <script type="module">import "<%= module_name %>";</script>
  <% end %>
</body>
</html>
