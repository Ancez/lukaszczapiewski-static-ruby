<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- Primary Meta Tags -->
  <title><%= @title || 'Lukasz Czapiewski - Full Stack Developer' %></title>
  <meta name="title" content="<%= @title || 'Lukasz Czapiewski - Full Stack Developer' %>">
  <meta name="description" content="<%= @description || 'Full stack developer passionate about Ruby on Rails and building things that matter. Based in Cheltenham, UK.' %>">
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="<%= @url || 'https://lukaszczapiewski.com' %>">
  <meta property="og:title" content="<%= @title || 'Lukasz Czapiewski - Full Stack Developer' %>">
  <meta property="og:description" content="<%= @description || 'Full stack developer passionate about Ruby on Rails and building things that matter. Based in Cheltenham, UK.' %>">
  <meta property="og:image" content="<%= @image || 'https://lukaszczapiewski.com/images/profile.jpeg' %>">
  
  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="<%= @url || 'https://lukaszczapiewski.com' %>">
  <meta property="twitter:title" content="<%= @title || 'Lukasz Czapiewski - Full Stack Developer' %>">
  <meta property="twitter:description" content="<%= @description || 'Full stack developer passionate about Ruby on Rails and building things that matter. Based in Cheltenham, UK.' %>">
  <meta property="twitter:image" content="<%= @image || 'https://lukaszczapiewski.com/images/profile.jpeg' %>">
  
  <!-- Canonical URL -->
  <link rel="canonical" href="<%= @url || 'https://lukaszczapiewski.com' %>">
  
  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  
  <!-- Stylesheet -->
  <link rel="stylesheet" href="/assets/stylesheets/application.css">
  
  <!-- Theme initialization script to prevent flash -->
  <script>
    (function() {
      function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
        return null;
      }
      const theme = getCookie('theme') || 'dark';
      if (theme === 'light') {
        document.documentElement.classList.remove('dark');
      } else {
        document.documentElement.classList.add('dark');
      }
    })();
  </script>
</head>
<body class="dark:bg-slate-950 bg-slate-50">
  <% 
    # Automatically set @current_page from @url if not already set
    @current_page ||= if @url
      uri = URI.parse(@url)
      uri.path
    else
      '/'
    end
  %>
  <main class="dark:bg-slate-950 bg-slate-50">
    <%= render 'shared/header' %>
    <%= page_content %>
    <%= render 'shared/footer' %>
  </main>

  <!-- Theme Switcher -->
  <div 
    data-controller="theme-switcher" 
    class="fixed bottom-6 right-6 z-50 opacity-0 translate-y-4 pointer-events-none transition-all duration-500 ease-out"
  >
    <button
      type="button"
      data-action="click->theme-switcher#toggle"
      class="group relative w-20 h-20 flex items-center justify-center cursor-pointer focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 dark:focus:ring-offset-slate-950 focus:ring-offset-slate-50 rounded-full"
      aria-label="Toggle theme"
    >
      <!-- Cloud Background -->
      <svg 
        class="absolute inset-0 w-full h-full theme-switcher-cloud dark:opacity-100 opacity-100 transition-opacity duration-300"
        viewBox="0 0 100 100"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <!-- Cloud shape -->
        <path 
          d="M25 50C25 40 30 35 35 35C35 30 40 25 50 25C60 25 65 30 65 35C70 35 75 40 75 50C80 50 85 55 85 60C85 65 80 70 75 70H25C20 70 15 65 15 60C15 55 20 50 25 50Z"
          class="fill-slate-400 dark:fill-slate-500 transition-colors duration-300"
        />
      </svg>

      <!-- Sun (visible in dark mode) -->
      <svg 
        class="absolute inset-0 w-full h-full theme-switcher-sun dark:opacity-100 opacity-0 transition-opacity duration-300 dark:text-blue-600"
        viewBox="0 0 100 100"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <circle cx="50" cy="50" r="20" fill="currentColor" />
        <path d="M50 10 L50 5 M50 95 L50 90 M10 50 L5 50 M95 50 L90 50" stroke="currentColor" stroke-width="3" stroke-linecap="round" />
        <path d="M25.86 25.86 L22.63 22.63 M77.37 77.37 L74.14 74.14 M25.86 74.14 L22.63 77.37 M77.37 22.63 L74.14 25.86" stroke="currentColor" stroke-width="3" stroke-linecap="round" />
      </svg>

      <!-- Moon (visible in light mode) -->
      <svg 
        class="absolute inset-0 w-full h-full theme-switcher-moon dark:opacity-0 opacity-100 transition-opacity duration-300 text-amber-300"
        viewBox="0 0 100 100"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path 
          d="M50 20C50 20 35 30 35 50C35 70 45 80 50 80C45 80 35 70 35 50C35 30 50 20 50 20Z"
          fill="currentColor"
        />
      </svg>
    </button>
  </div>

  <% if importmap_json %>
    <script type="importmap">
      <%= raw importmap_json %>
    </script>
  <% end %>

  <% if @js_modules && !@js_modules.empty? %>
    <% @js_modules.each do |module_name| %>
      <script type="module">import "<%= module_name %>";</script>
    <% end %>
  <% end %>
  <script type="module">import "application";</script>
</body>
</html>
